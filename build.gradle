description = "Post on my fridge"

apply plugin: 'java'
defaultTasks 'gaeDownloadSdk', 'gaeExplodeWar', 'minifyFridgeCss', 'minifyFridgeJs','combineLibJs', 'gaeRun'

repositories {
	mavenCentral()
	mavenRepo name:'objectify-appengine-releases', url:'http://objectify-appengine.googlecode.com/svn/maven'
}

buildscript {
	repositories { mavenCentral() }
	dependencies {
		classpath 'com.eriwen:gradle-js-plugin:1.0.3'
		classpath 'com.eriwen:gradle-css-plugin:0.3'
	}
}

apply plugin: 'js'

task jshintFridge(type: com.eriwen.gradle.js.tasks.JsHintTask) {
	source = [
		"${projectDir}/src/main/webapp/js/pomf/init.js",
		"${projectDir}/src/main/webapp/js/pomf/post.js",
		"${projectDir}/src/main/webapp/js/pomf/tools.js",
		"${projectDir}/src/main/webapp/js/pomf/konami.js"
	]
}

task combineLibJs(type: com.eriwen.gradle.js.tasks.CombineJsTask) {
	source = [
		"${projectDir}/src/main/webapp/js/lib/jquery-1.7.2.min.js",
		"${projectDir}/src/main/webapp/js/lib/jquery-ui-1.8.21.custom.min.js",
		"${projectDir}/src/main/webapp/js/lib/humane-3.0.0.min.js",
		"${projectDir}/src/main/webapp/js/lib/underscore-1.3.3.min.js",
		"${projectDir}/src/main/webapp/js/lib/farbtastic-1.3.min.js",
		"${projectDir}/src/main/webapp/js/lib/humane-date-0.0.1.min.js",
		"${projectDir}/src/main/webapp/js/lib/mustache-0.4.2.min.js",
		"${projectDir}/src/main/webapp/js/lib/jquery.tipsy-1.0.0a.min.js",
		"${projectDir}/src/main/webapp/js/lib/date-1.0.a1.min.js"
	]
	dest = file("${buildDir}/exploded-war/js/pomf/lib.min.js")
}

task combineFridgeJs(type: com.eriwen.gradle.js.tasks.CombineJsTask) {
	source = [
		"${projectDir}/src/main/webapp/js/pomf/init.js",
		"${projectDir}/src/main/webapp/js/pomf/post.js",
		"${projectDir}/src/main/webapp/js/pomf/tools.js",
		"${projectDir}/src/main/webapp/js/pomf/konami.js"
	]
	dest = file("${buildDir}/exploded-war/js/pomf/fridge.js")
}

task minifyFridgeJs(type: com.eriwen.gradle.js.tasks.MinifyJsTask, dependsOn: 'combineFridgeJs') {
	source = file("${buildDir}/exploded-war/js/pomf/fridge.js")
	dest = file("${buildDir}/exploded-war/js/pomf/fridge.min.js")
	closure {
		closure.compilationLevel =  'ADVANCED_OPTIMIZATIONS'
	}
}

apply plugin: 'css'

task combineFridgeCss(type: com.eriwen.gradle.css.tasks.CombineCssTask) {
	source = [
		"${projectDir}/src/main/webapp/css/pomf/post.css",
		"${projectDir}/src/main/webapp/css/pomf/layout.css"
	]
	dest = file("${buildDir}/exploded-war/css/pomf/fridge.css")
}

task minifyFridgeCss(type: com.eriwen.gradle.css.tasks.MinifyCssTask, dependsOn: 'combineFridgeCss') {
	source = file("${buildDir}/exploded-war/css/pomf/fridge.css")
	dest = file("${buildDir}/exploded-war/css/pomf/fridge.min.css")
}


buildscript {
	repositories {
		add(new org.apache.ivy.plugins.resolver.URLResolver()) {
			name = 'GitHub'
			addArtifactPattern 'http://cloud.github.com/downloads/[organisation]/[module]/[module]-[revision].[ext]'
		}
	}
	dependencies { classpath 'bmuschko:gradle-gae-plugin:0.7.5' }
}

apply plugin: 'gae'

gae {
	httpPort = 8888
	stopKey = null
	disableUpdateCheck = true
	downloadSdk = true
	warDir = file('build/exploded-war/')
	appcfg { email = 'arnaud.gourlay@gmail.com' }
}

dependencies {
	gaeSdk 'com.google.appengine:appengine-java-sdk:1.7.0'
	compile 'com.google.appengine:appengine-api-1.0-sdk:1.7.0'
	compile 'com.google.code.gson:gson:2.2.2'
	compile 'javax.servlet:servlet-api:2.5'
	compile 'joda-time:joda-time:2.1'
	compile 'com.sun.jersey:jersey-bundle:1.13-b01'
	compile 'com.google.guava:guava:13.0-rc1'
	compile 'org.codehaus.jackson:jackson-core-asl:1.9.7'
	compile 'org.codehaus.jackson:jackson-mapper-asl:1.9.7'
	compile 'org.codehaus.jackson:jackson-jaxrs:1.9.7'
	compile 'org.codehaus.jackson:jackson-xc:1.9.7'
	compile 'com.googlecode.objectify:objectify:3.1'
	compile 'javax.persistence:persistence-api:1.0.2'
	compile 'asm:asm:3.3.1'
	testCompile 'junit:junit:4.10'
}